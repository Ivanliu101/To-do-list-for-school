<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>待辦事項</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #fff;
            padding: 20px;
            margin:0;
            position: relative;
        }

        h1 { margin-bottom: 20px; }

        /* 右上角按鈕 */
        #top-right {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 10000;
        }

        .glass-btn {
            padding: 10px 15px;
            border-radius: 15px;
            background: rgba(255,255,255,0.25);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow:0 8px 25px rgba(0,0,0,0.15);
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .glass-btn:hover {
            transform: translateY(-2px);
            background: rgba(255,255,255,0.35);
        }

        /* 任務列表 */
        #task-list { margin-top: 80px; }

        .task {
            display:flex;
            align-items:center;
            gap:10px;
            padding:10px;
            border-radius:15px;
            background: rgba(255,255,255,0.25);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow:0 8px 25px rgba(0,0,0,0.15);
            margin-bottom:10px;
            position: relative;
        }

        .task.completed { background: rgba(39,174,96,0.25); }
        .task.late { background: rgba(255,221,0,0.35); }

        /* Tag */
        .task-tags {
            display:flex;
            gap:5px;
            flex-wrap:wrap;
        }

        .tag {
            display:inline-block;
            padding:5px 10px;
            border-radius:15px;
            font-size:13px;
            color:#000;
            text-shadow: 0 1px 2px rgba(0,0,0,0.4);
            border:1px solid rgba(255,255,255,0.5);
            box-shadow:0 8px 25px rgba(0,0,0,0.15);
            background: rgba(255,255,255,0.25);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transition: all 0.2s ease;
            cursor:default;
            position:relative;
            z-index:1;
        }

        .tag:hover {
            transform: translateY(-4px);
            box-shadow:0 12px 30px rgba(0,0,0,0.2);
            background: rgba(255,255,255,0.35);
        }

        .tag-summary { background: rgba(74,144,226,0.25); }
        .tag-formative { background: rgba(39,174,96,0.25); }
        .tag-homework { background: rgba(0,51,102,0.25); }

        .subject-tag { background: rgba(255,182,193,0.25); }

        .complete-btn {
            padding:5px 10px;
            border-radius:15px;
            background: rgba(255,255,255,0.35);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border:1px solid rgba(255,255,255,0.5);
            box-shadow:0 8px 25px rgba(0,0,0,0.15);
            cursor:pointer;
            transition: all 0.2s ease;
        }
        .complete-btn:hover {
            transform: translateY(-2px);
            background: rgba(255,255,255,0.45);
        }

        /* 新增任務彈窗 */
        #task-modal {
            display:none;
            position: fixed;
            top:50%;
            left:50%;
            transform: translate(-50%,-50%);
            background: rgba(255,255,255,0.35);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 10001;
        }

        #task-modal input {
            margin-bottom: 10px;
            padding:5px;
            width: 100%;
        }

    </style>
</head>
<body>

<h1>待辦事項</h1>

<div id="top-right">
    <button id="download-btn" class="glass-btn">下載檔案</button>
    <button id="upload-btn" class="glass-btn">匯入檔案</button>
    <button id="add-task" class="glass-btn">新增任務</button>
</div>

<div id="task-list"></div>

<div id="task-modal">
    <h3>新增任務</h3>
    <input type="text" id="task-name" placeholder="任務名稱">
    <input type="text" id="task-due" placeholder="繳交時間 YYYY/MM/DD HH:MM">
    <input type="text" id="task-tags" placeholder="Tag(多選,逗號分隔)">
    <input type="text" id="task-subjects" placeholder="科目(多選,逗號分隔)">
    <button id="save-task" class="glass-btn">儲存任務</button>
    <button class="glass-btn" onclick="closeModal()">取消</button>
</div>

<script>
    let taskList = [];

    function renderTasks(){
        const container = document.getElementById('task-list');
        container.innerHTML='';
        taskList.sort((a,b)=> b.late - a.late);
        taskList.forEach(task=>{
            const div = document.createElement('div');
            div.className='task';
            if(task.completed) div.classList.add('completed');
            if(task.late) div.classList.add('late');

            const tagDiv = document.createElement('div');
            tagDiv.className='task-tags';

            task.tags.forEach(t=>{
                const span=document.createElement('span');
                span.className='tag';
                if(t==="總結性評量") span.classList.add('tag-summary');
                if(t==="形成性評量") span.classList.add('tag-formative');
                if(t==="作業") span.classList.add('tag-homework');
                span.textContent=t;
                tagDiv.appendChild(span);
            });

            task.subjects.forEach(s=>{
                const span=document.createElement('span');
                span.className='tag subject-tag';
                span.textContent=s;
                tagDiv.appendChild(span);
            });

            div.appendChild(tagDiv);

            const nameSpan=document.createElement('span');
            nameSpan.textContent=task.name;
            div.appendChild(nameSpan);

            const dateSpan=document.createElement('span');
            dateSpan.textContent=task.due;
            div.appendChild(dateSpan);

            const btn=document.createElement('button');
            btn.className='complete-btn';
            btn.textContent='完成';
            btn.onclick=()=>{
                task.completed=true;
                renderTasks();
            };
            div.appendChild(btn);

            container.appendChild(div);
        });
    }

    document.getElementById('add-task').onclick = ()=>{
        document.getElementById('task-modal').style.display='block';
    };
    function closeModal(){
        document.getElementById('task-modal').style.display='none';
        document.getElementById('task-name').value='';
        document.getElementById('task-due').value='';
        document.getElementById('task-tags').value='';
        document.getElementById('task-subjects').value='';
    }

    document.getElementById('save-task').onclick=()=>{
        const name=document.getElementById('task-name').value;
        const due=document.getElementById('task-due').value;
        const tagArr=document.getElementById('task-tags').value.split(',').map(t=>t.trim()).filter(t=>t);
        const subArr=document.getElementById('task-subjects').value.split(',').map(s=>s.trim()).filter(s=>s);
        const late = new Date(due) < new Date() ? 1:0;
        taskList.push({name,due,tags:tagArr,subjects:subArr,completed:false,late});
        closeModal();
        renderTasks();
    };

    // TODO: 下載 & 匯入功能可用 File API 實作
    document.getElementById('download-btn').onclick = ()=>{
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(taskList));
        const dlAnchor = document.createElement('a');
        dlAnchor.setAttribute("href", dataStr);
        dlAnchor.setAttribute("download", "tasks.json");
        dlAnchor.click();
    };

    document.getElementById('upload-btn').onclick = ()=>{
        const input = document.createElement('input');
        input.type='file';
        input.accept='.json';
        input.onchange=e=>{
            const file=e.target.files[0];
            const reader=new FileReader();
            reader.onload=ev=>{
                taskList=JSON.parse(ev.target.result);
                renderTasks();
            };
            reader.readAsText(file);
        };
        input.click();
    };

</script>
</body>
</html>